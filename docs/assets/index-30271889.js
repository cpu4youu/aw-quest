import{s as o,e as T,g as $,S as p,T as k,d as b,q as j,Q as d,u as x,D as L,R as c,_ as C,n as F,j as t,A,I as D,F as O,f as m}from"./index-b85ef81b.js";import{u as I}from"./use-transaction-5037798d.js";import{u as P}from"./settings-73c06ae8.js";import{d as y}from"./defaultAvatar-25be0dfd.js";import{s as Q}from"./sleep-da79c358.js";import{i as z}from"./index-86d96a35.js";import"./toast-options-87c4d3f5.js";const B=o("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",w:"100%"}),q=o("h2",{d:"flex",align:"center",justify:"center",color:"$white500"}),N=o("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"15px",mt:"15px",bg:"rgba(255, 255, 255, 0.05)",br:"10px",w:"100%",color:"$white500"}),W=o("div",{d:"flex",align:"flex-start",justify:"center",w:"100%",padding:"15px",br:"5px",color:"$white500"}),U=o("div",{d:"flex",align:"center",justify:"center",mr:"15px",minW:"60px",maxW:"60px",h:"60px",border:"2px solid grey",br:"999px",overflow:"hidden",img:{w:"60px",h:"60px"}}),K=o("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",w:"100%",color:"$white500"}),G=T({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),f=o("div",{m:"10px 0",w:"95%",height:"120px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1) ,rgba(255, 255, 255, 0.2))",br:"10px",backgroundSize:"400% 400%",animation:`${G} 1.2s ease-in-out infinite`}),Y=o("p",{d:"flex",align:"center",justify:"center",height:"320px",w:"100%",fw:"$thin",fs:"26px",ff:"$body",color:"$white500"}),H=o("span",{fw:"$thin",fs:"16px",ff:"$body",color:"$white500",svg:{w:"13px",h:"13px"}}),V=o("button",{d:"flex",align:"center",justify:"center",gap:"5px",mt:"10px",h:"28px",minW:"65px",borderRadius:"4px",border:" 1px solid #8F8F8F",background:"rgba(0, 0, 0, 0.22)",padding:"0px 10px 0 5px",fw:"$thin",fs:"14px",ff:"$body",color:"$white500","&[disabled]":{opacity:"0.5",cursor:"not-allowed"}}),J=async()=>await $({options:{code:p.MEMBERS_MC,index_position:1,limit:"3",reverse:!0,scope:p.MEMBERS_MC,table:k.SPONSOR}}),X=()=>b({queryKey:[d.SPONSOR],queryFn:()=>Z(),staleTime:1e3*60*60*24});async function w(){return await j.invalidateQueries(d.SPONSOR)}async function Z(){try{const e=await J();return e?ee(e):[]}catch(e){return console.log(e),null}}function ee(e){return e.map(n=>({...n,avatar:n.avatar.split(";")[0],avatarCollection:n.avatar.split(";")[1]}))}async function te(e,n,a){const{executeTransaction:s}=I(),l=ne(e,n,a);return!!await s(l)}function ne(e,n,a){return{actions:[{account:p.MEMBERS_MC,name:"like",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,type:n,contentid:a}}]}}const re=()=>b({queryKey:[d.MEMBERS],queryFn:()=>ae(),staleTime:1e3*60*60*24,enabled:!!x.getState().user});async function S(){return await j.invalidateQueries(d.MEMBERS)}async function ae(){const e=x.getState().user;if(!e)return null;try{const n=await L(e==null?void 0:e.name);return n?{...n,avatar:n.avatar.split(";")[0],avatarCollection:n.avatar.split(";")[1]}:null}catch(n){return console.log(n),null}}const oe=c.lazy(()=>C(()=>import("./fire-fill-965431a9.js"),["assets/fire-fill-965431a9.js","assets/index-b85ef81b.js","assets/index-55fec1ff.css"])),xe=()=>{const{data:e,isLoading:n}=X(),{data:a}=re(),{data:s}=P(),l=x(r=>r.user),i=c.useRef(null),[g,h]=c.useState(!1);async function v(r){if(!l){m.error("User not found, please login");return}try{h(!0),await te(l,"sponsor",r)&&(m.success("Liked"),await Q(800),await S(),await w())}catch(u){console.log(u)}finally{h(!1)}}function E(){i!=null&&i.current&&(i.current.src=y)}const M=c.useMemo(()=>{if(!(a!=null&&a.last_like))return!1;const r=new Date(a==null?void 0:a.last_like).getTime(),u=(s==null?void 0:s.likecd_minutes)??0,_=r+u*6e4,R=F.getTime();return!z(R,_)},[a,s==null?void 0:s.likecd_minutes]);return c.useEffect(()=>{const r=setInterval(()=>{S(),w()},6e4);return()=>clearInterval(r)},[]),t.jsxs(B,{children:[t.jsx(q,{children:"LATEST SPONSORS"}),t.jsx(N,{children:n?t.jsxs(t.Fragment,{children:[t.jsx(f,{}),t.jsx(f,{}),t.jsx(f,{})]}):(e==null?void 0:e.length)===0?t.jsx(Y,{children:"No Sponsors for now"}):e==null?void 0:e.map(r=>t.jsxs(W,{children:[t.jsx(U,{children:r.avatarCollection==="alienavatars "?t.jsx("img",{loading:"lazy",src:`${A}/ipfs/${r.avatar}`,style:{width:"240px",height:"400px",minWidth:"240px",minHeight:"400px",objectFit:"none",scale:"0.24",objectPosition:"45% 1.5%"}}):t.jsx("img",{loading:"lazy",ref:i,onError:E,src:r.avatar!=="-"?`${D}/ipfs/${r.avatar}`:y,alt:""})}),t.jsxs(K,{children:[t.jsx(H,{children:r.log}),t.jsx(V,{onClick:()=>v(r.index),disabled:g||M,children:g?t.jsx(O,{size:"sm",colorSchema:"light"}):t.jsxs(t.Fragment,{children:[t.jsx(oe,{}),r.likes]})})]})]},r.index))})]})};export{xe as default};
