import{g as c,S as s,T as i,b as _,d as M,Q as u,q as w,n as S}from"./index-5c5264f1.js";import{i as E}from"./index-1aba9e3c.js";const d=async()=>await c({options:{code:s.USPTS_WORLDS,index_position:1,limit:"10000",reverse:!0,key_type:"i64",scope:s.USPTS_WORLDS,table:i.LEVEL_OFFERS}}),f=async e=>{var t,n;let a=!1,r;const l=[];for(;!a;){const o=await _.get_table_rows({code:s.MEMBERS_MC,index_position:1,limit:"10000",key_type:"i64",scope:s.MEMBERS_MC,table:i.MEMBERS,lower_bound:e??r,upper_bound:e,json:!0});a=!o.more,l.push(...o.rows.slice(0,-1)),r=((n=(t=o.rows)==null?void 0:t[o.rows.length-1])==null?void 0:n.wallet)??""}return l},g=async e=>await c({options:{code:s.MEMBERS_MC,limit:"10000",reverse:!0,scope:s.MEMBERS_MC,table:i.suplog,index_position:2,lower_bound:e,upper_bound:e}}),R=()=>M({queryKey:[u.NEWS_MEMBERS],queryFn:()=>y(),refetchInterval:6e4,refetchIntervalInBackground:!1,staleTime:1e3*60*60});async function T(){return await w.invalidateQueries(u.NEWS_MEMBERS)}async function y(){try{const e=await f(),a=await d();if(!e||!a)return null;const r=await m(e,a);return console.log(r),r}catch(e){return console.log(e),null}}async function m(e,a){const r=e==null?void 0:e.filter(t=>t.trial&&!t.flagged&&E(S,new Date(t.next_review)));return(await Promise.all(r.map(async t=>{var o;return{...await g(t.wallet),...t,avatar:t.avatar.split(";")[0],avatarCollection:t.avatar.split(";")[1],newMemberLevel:((o=a.find(p=>t.mcp_start>=p.required))==null?void 0:o.level)??1}}))).sort((t,n)=>n.member_id-t.member_id)}export{T as o,R as u};
