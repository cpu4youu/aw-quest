import{s as p,j as t,R as M,e as q,c as H,S as f,u as K,g as _,T,ab as Y,l as L,aw as J,a as F,Q as S,q as G,b as g,ax as I,N as V,h as N,B as X,k as C,m as Z}from"./index-6679fbd8.js";import{S as m}from"./styles-b91c3087.js";import{B as P}from"./bolt-d498c4be.js";import{d as w}from"./defaultAvatar-db08d924.js";import{S as A}from"./index-112a0220.js";import{I as ee}from"./info-builder-25855841.js";import"./index.esm-bac46e82.js";import"./index-5cf1e5a9.js";import"./index-999bd3e9.js";import"./index-e2678f3c.js";import"./gradient-border-f1bbcf33.js";const te=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",h2:{mt:"30px",color:"$white500",letterSpacing:"2px",textShadow:" 0px 4px 4px rgba(0, 0, 0, 0.5)"}}),ne=()=>t.jsx(te,{children:t.jsx("h2",{children:"No candidates to this planet"})}),oe=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",".nfts":{w:"100%",h:"70px",br:"10px"}}),re=()=>t.jsxs(oe,{children:[t.jsx(m,{className:"nfts"}),t.jsx(m,{className:"nfts"}),t.jsx(m,{className:"nfts"}),t.jsx(m,{className:"nfts"})]}),ae=p("div",{d:"grid",gridTemplateColumns:"1.5fr 1.35fr 1.15fr 0.95fr",minH:"100px",bg:"rgba(0, 0, 0, .3)",w:"100%",padding:"5px 0","&:hover":{boxShadow:"0px 0px 15px rgba(255,255,255,0.5)"},"@sm":{padding:"0 5px 0 0",gap:"15px",gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),se=p("div",{d:"flex",align:"center",justify:"space-around",gap:"50px",margin:"0 auto 0 45px",img:{br:"50%",h:"70px",w:"70px"},variants:{position:{true:{img:{border:"1px solid #EBB309"}},false:{img:{border:"1px solid #5F5F5F"}}}},"@sm":{gap:"0px",margin:"0 auto 0 15px",img:{h:"40px",w:"40px"}}}),ie=p("div",{d:"flex",align:"center",justify:"center",color:"$white500",w:"40px",fs:"24px",fw:"$bold",ff:"$heading","@sm":{fs:"20px"}}),le=p("span",{d:"flex",align:"center",justify:"center",textAlign:"center",color:"$white500",my:"auto",w:"100%",fw:"$bold",fs:"16px",ff:"$heading",lineHeight:"17px","@sm":{justify:"center",fs:"10px"}}),ce=p("span",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"5px",w:"100%",fs:"20px",ff:"$heading","@sm":{d:"none"}}),pe=p("div",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"10px",w:"100%",fs:"20px",ff:"$heading","@sm":{gap:"10px",fs:"10px"}}),xe=({data:e,position:r})=>{var l;const n=M.useRef(null);function a(){n!=null&&n.current&&(n.current.src=w)}return t.jsxs(ae,{children:[t.jsxs(se,{position:r<2,children:[t.jsx("img",{ref:n,src:(e==null?void 0:e.image)??w,onError:a,alt:"avatar user image"}),t.jsx(ie,{children:r+1})]}),t.jsx(le,{children:(e==null?void 0:e.givenName)??(e==null?void 0:e.candidate_name)}),t.jsx(ce,{children:e==null?void 0:e.candidate_name}),t.jsxs(pe,{children:[((l=e==null?void 0:e.votes)==null?void 0:l.toLocaleString("en-US"))??0,t.jsx(P,{type:2})]})]})},ue=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",zIndex:"12",w:"100%"}),fe=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),de=p("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),me=p("a",{d:"flex",align:"center",justify:"center",color:"$white500",svg:{mt:"10px",w:"40px",h:"40px"},"@sm":{svg:{mt:"5px",w:"30px",h:"30px"}}}),ge=p("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gridArea:"content",padding:"20px 20px 30px",gap:"7px",w:"100%",maxW:"1190px"}),he=p("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",m:"30px 0 30px",w:"100%",svg:{w:"40px",h:"40px"},"@sm":{px:"10px"}}),we=p("div",{d:"grid",gridTemplateColumns:"1.5fr 1.2fr 1fr 1fr",gridTemplateAreas:"'header header header header' 'content content content content'",mt:"50px",h:"40px",w:"100%",bg:"rgba(0, 0, 0, .3)","@sm":{gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),y=p("span",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"20px",ff:"$heading",fw:"$bold",textShadow:"1px 1px 10px black",textAlign:"center",h:"40px","&:nth-child(4)":{pr:"10px"},"@sm":{fs:"10px",fw:"$normal",w:"100% !important"}}),ve=q({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),je=p("div",{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",w:"100%",gap:"30px",">button":{minWidth:"100%",height:"50px",fs:"20px"}}),ye=p("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"100%",gap:"30px","@sm":{flexWrap:"wrap"}}),R=p("div",{display:"flex",alignItems:"center",justifyContent:"flex-start",flexDirection:"column",padding:"40px",h:"100%",w:"100%",bg:"rgba(0, 0, 0, .3)",br:"10px","@md":{padding:"20px"},"@sm":{h:"max-content",padding:"20px"}}),B=p("div",{display:"flex",alignItems:"center",justifyContent:"space-between",h:"100%",w:"450px","@md":{w:"100%"}}),D=p("div",{d:"flex",align:"center",justify:"center",br:"9999999px",border:"5px solid grey",overflow:"hidden",position:"relative",w:"100px",h:"100px",img:{position:"absolute",inset:"-2px",w:"100px",h:"100px"},variants:{rarity:{Abundant:{borderColor:"#737373"},Common:{borderColor:"#232323"},Rare:{borderColor:"#3d74e9"},Epic:{borderColor:"#8719f0"},Legendary:{borderColor:"#da992e"},Mythical:{borderColor:"#d20066"}}},"@sm":{w:"80px",h:"80px",img:{w:"80px",h:"80px"}}}),b=p("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"450px",h:"230px",color:"$white500",mt:"20px",textAlign:"center",fs:"16px",ff:"$heading",maxH:"400px",overflow:"auto",strong:{fs:"26px"},".loading":{background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15) ,rgba(255, 255, 255, 0.35))",backgroundSize:"400% 400%",animation:`${ve} 1.2s ease-in-out infinite`,h:"100%",w:"100%"},"@md":{w:"100%"},"@sm":{fs:"12px"}}),be={type:"ranking",planet:{label:"Naron",value:"naron"}},Q=H((e,r)=>({voteFilters:be,updateVoteFilters:n=>_e(e,n),votePower:0,updateVotePower:n=>Te(e,n),votePowerValue:0,updateVotePowerValue:n=>Se(e,n)}));function _e(e,r){e(n=>({...n,voteFilters:{...n.voteFilters,...r}}))}function Te(e,r){e(n=>({...n,votePower:r}))}function Se(e,r){e(n=>({...n,votePowerValue:r}))}async function Ne(e,r,n,a){const{executeTransaction:l}=K(),c=Ce(e,r,n,a);return!!await l(c)}function Ce(e,r,n,a){return{actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:e.name,type:4}},{account:f.VOTING_MC,name:"claimpower",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,claim_user_cpu:!0}},{account:f.VOTING_MC,name:"castvote",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,new_candidates:r,planet:n,votes:a}}]}}const Ie=async e=>await _({options:{code:f.DAO_WORLDS,index_position:1,limit:"1000",scope:e,table:T.CANDIDATES}}),Ve=async e=>await _({options:{code:f.VOTING_MC,index_position:3,key_type:"i64",limit:"1000",lower_bound:e,upper_bound:e,scope:f.VOTING_MC,table:T.CANDIDATES}}),z=Y.create({baseURL:"https://api.alienworlds.io/v2/dao/"});z.interceptors.response.use(e=>e.data,e=>{var n,a;const r=((a=(n=e.response)==null?void 0:n.data)==null?void 0:a.message)||e.message;return L.error(r,J),Promise.reject(e)});const $e=async()=>await _({options:{code:f.VOTING_MC,index_position:1,limit:"1000",scope:f.VOTING_MC,table:T.blocklist}}),Ee=e=>F({queryKey:[S.CANDIDATES,e],queryFn:()=>Ae(e||"eyeke"),staleTime:1e3*60*5});async function ke(){return await G.invalidateQueries(S.CANDIDATES)}async function Ae(e){try{const r=await Ie(e),n=await Ve(e),a=await z.get(`${e}/candidates?walletId=aa`);if(!n||!r)return[];const l=Re(n,r,a),c=await $e();return c!=null&&c.length?l.filter(u=>c==null?void 0:c.some(o=>o.wallet!==u.account)):l}catch(r){return console.log(r),null}}function Re(e,r,n){return r.filter(c=>c.is_active===1).map(c=>{const i=e.find(o=>o.wallet===c.candidate_name),u=n==null?void 0:n.find(o=>o.account===c.candidate_name);return{...c,...u,...i}}).sort((c,i)=>i.votes-c.votes)}const Be=async()=>{const e=await _({options:{code:f.VOTING_MC,index_position:1,limit:"1000",scope:f.VOTING_MC,table:T.CONFIG_MEMBERS}});return(e==null?void 0:e[0])??null},De=()=>F({queryKey:[S.VOTES],queryFn:()=>Me(),staleTime:1e3*60*5,enabled:!!g.getState().user});async function O(){return await G.invalidateQueries(S.VOTES)}async function Me(){const e=g.getState().user;if(!e)return{current_vote_power:0,max_vote_power:0};try{const r=await Be(),n=Q.getState().updateVotePower,a=e==null?void 0:e.vote_power;let l=(e==null?void 0:e.last_voteclaim_shards)??0,c=(e==null?void 0:e.total_points)??0;if(!(e!=null&&e.total_points)){const o=await I(e.name);c=(o==null?void 0:o.total_points)??0}if(!(e!=null&&e.last_voteclaim_shards)){const o=await V(e.name);l=(o==null?void 0:o.last_voteclaim_shards)??0}let i=a+(c-l);const u=(r==null?void 0:r.max_votes)??0;return i>u&&(i=u),n(i),{current_vote_power:i,max_vote_power:u}}catch(r){return console.log(r),{current_vote_power:0,max_vote_power:0}}}const Le=({candidates:e,isLoading:r})=>{const n=Q(s=>s.votePower),a=g(s=>s.user),l=M.useRef(null),c=(e==null?void 0:e.map(s=>({label:s.givenName||s.candidate_name,value:s.candidate_name,...s})))??[],i=[{label:"None",value:"none"},...c],u=i==null?void 0:i[0],[o,d]=N.useState(u),[x,U]=N.useState(u);function $(s,h){h==="first"&&d(s),h==="second"&&U(s)}function E(){return[o==null?void 0:o.value,x==null?void 0:x.value].filter(s=>s!=="none")}async function W(){const s=E();if(!a||!s||((s==null?void 0:s.length)??0)===0||!n)return null;try{if(await Ne(a,s,"eyeke",Number(n))){if(await C(1200),a){const v=await I(a==null?void 0:a.name),j=await V(a==null?void 0:a.name);if(!v||!j)return;g.setState({user:{...a,total_points:v==null?void 0:v.total_points,member:j==null?void 0:j.member}})}await C(1200),await ke(),await O(),L.success("Vote successfully registered")}}catch(h){console.log(h)}}function k(){l!=null&&l.current&&(l.current.src=w)}return t.jsxs(je,{children:[t.jsxs(ye,{children:[t.jsx(R,{children:t.jsxs(t.Fragment,{children:[t.jsxs(B,{children:[t.jsx(A,{isLoading:r,onSelected:s=>$(s,"first"),options:i==null?void 0:i.filter(s=>(s==null?void 0:s.value)!==(x==null?void 0:x.value)),title:"None",selected:{label:o==null?void 0:o.label,value:o==null?void 0:o.value},borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),t.jsx(D,{rarity:a==null?void 0:a.avatarrarity,children:t.jsx("img",{ref:l,onError:k,src:o!=null&&o.image?o.image:w,alt:""})})]}),((i==null?void 0:i.length)??0)>0?t.jsx(b,{children:r?t.jsx(m,{className:"loading"}):(o==null?void 0:o.description)||"This candidate doesn't have description"}):t.jsx(b,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})}),t.jsx(R,{children:t.jsxs(t.Fragment,{children:[t.jsxs(B,{children:[t.jsx(A,{isLoading:r,onSelected:s=>$(s,"second"),options:i==null?void 0:i.filter(s=>(s==null?void 0:s.value)!==(o==null?void 0:o.value)),title:"None",selected:{label:x==null?void 0:x.label,value:x==null?void 0:x.value}}),t.jsx(D,{rarity:a==null?void 0:a.avatarrarity,children:t.jsx("img",{ref:l,onError:k,src:x!=null&&x.image?x.image:w,alt:""})})]}),((i==null?void 0:i.length)??0)>0?t.jsx(b,{children:r?t.jsx(m,{className:"loading"}):(x==null?void 0:x.description)||"This candidate doesn't have description"}):t.jsx(b,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})})]}),t.jsx(X,{onClick:W,disabled:n<=0||E().length===0,color:"solidBlue",noBorder:!0,rounded:!1,children:"Cast Vote"})]})},Ye=()=>{var i,u;const{isSmall:e}=Z(),{data:r}=De(),{data:n,isLoading:a}=Ee("eyeke"),l=g(o=>o.user);async function c(){if(l){const o=await I(l==null?void 0:l.name),d=await V(l==null?void 0:l.name);if(!o||!d)return;g.setState({user:{...l,total_points:o==null?void 0:o.total_points,member:d==null?void 0:d.member}}),await C(2e3),O()}}return N.useEffect(()=>{c()},[]),t.jsxs(ue,{children:[t.jsxs(fe,{children:[t.jsxs(de,{children:["Eyeke Voting",t.jsx(me,{href:"https://medium.com/mining-matters/feature-spotlight-voting-db0d7d9354e6",target:"_blank",children:t.jsx(ee,{})})]}),t.jsx("img",{src:"/assets/background/bg-voting.jpeg",alt:""})]}),t.jsxs(ge,{children:[t.jsxs(he,{children:[(i=r==null?void 0:r.current_vote_power)==null?void 0:i.toLocaleString("en-US")," /"," ",(u=r==null?void 0:r.max_vote_power)==null?void 0:u.toLocaleString("en-US")," ",t.jsx(P,{type:2})]}),t.jsx(Le,{isLoading:a,candidates:n}),t.jsxs(we,{children:[t.jsx(y,{children:"Rank"}),t.jsx(y,{children:"Candidate"}),!e&&t.jsx(y,{children:"Wallet"}),t.jsx(y,{children:"Votes"})]}),a?t.jsx(re,{}):(n==null?void 0:n.length)===0?t.jsx(ne,{}):n==null?void 0:n.map((o,d)=>t.jsx(xe,{position:d,data:o},o.candidate_name))]})]})};export{Ye as default};
