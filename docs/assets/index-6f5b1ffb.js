import{s as c,e as ve,S as ke,R as L,_ as T,u as A,r as h,j as s,A as Ne,B as g,D as ie,f as S}from"./index-b85ef81b.js";import{u as Ae}from"./index-2359b281.js";import{a as We}from"./index.esm-80be0e76.js";import{u as $e,o as W}from"./get-user-settings-assets-query-dc85660e.js";import{u as Pe,o as re}from"./tools-query-918680e4.js";import{u as Be}from"./use-transaction-5037798d.js";import{s as v}from"./sleep-da79c358.js";import{a as ze,e as Ve}from"./execute-remove-favorites-land-contract-89fca12b.js";import{e as De}from"./execute-equip-tools-contract-1889173f.js";import{o as Ge}from"./inventory-query-cd35d561.js";import{u as Ue,o as I}from"./user-miners-query-1ae6f174.js";import{u as M,g as He,s as Oe}from"./showTlmValueFromMine-6cc19260.js";import{e as Qe}from"./execute-claim-contract-dd661d38.js";import{d as $,a as ne,c as oe}from"./mineCooldown-6e50a17a.js";import{u as qe,o as Ye}from"./lands-query-0d9d3518.js";import{c as ae,a as ce}from"./calculateShardsByLand-b9c6503e.js";import{T as le}from"./index-ac701920.js";import{u as Je}from"./get-planet-config-4455e980.js";import{v as xe}from"./v4-4a60fe23.js";import"./iconBase-ade42cb6.js";import"./adapters-a223269f.js";import"./axios-45629df5.js";import"./toast-options-87c4d3f5.js";import"./lands-55b42b35.js";import"./index-86d96a35.js";import"./index-afe51e18.js";import"./index-85cb3e9c.js";import"./index-eac0f6d3.js";import"./use-media-8e36c1c0.js";const Ke=c("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px",padding:"0 10px",">svg":{mr:"auto",mt:"20px",cursor:"pointer"}}),de=c("h3",{d:"flex",justify:"space-between",w:"100%",mr:"auto",mt:"25px",gap:"10px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500",">button":{h:"25px",div:{fs:"16px",border:"none",br:"10px"}},"@sm":{align:"center",fs:"18px",flexWrap:"wrap",svg:{w:"25px",h:"25px"}}}),pe=c("h4",{w:"100%",textAlign:"center",fs:"22px",fw:"$normal",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),Xe=c("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"30px",mb:"30px",w:"100%","@sm":{gap:"10px",justify:"center"}}),Ze=c("div",{d:"flex",align:"center",justify:"center",w:"100%",variants:{isSelected:{true:{">div:last-child":{border:"3px solid #00BAFF","@sm":{border:"1px solid #00BAFF"}}}}},"@sm":{justify:"center"}}),es=c("div",{d:"flex",align:"center",justify:"flex-start",gap:"6px",w:"100%",maxW:"260px"}),ss=c("div",{w:"82px",h:"82px",border:"3px solid $black500",overflow:"hidden",br:"5px",">img":{w:"82px",h:"82px",objectFit:"cover",objectPosition:"center 3px",scale:"1.9"},variants:{rarity:{Abundant:{borderColor:"#4c4c4c"},Common:{borderColor:"#000000"},Rare:{borderColor:"#3d74e9"},Epic:{borderColor:"#8719f0"},Legendary:{borderColor:"#da992e"},Mythical:{borderColor:"#d20066"}}},"@sm":{w:"52px",h:"52px",">img":{w:"52px",h:"52px"}}}),ts=c("div",{d:"flex",align:"center",justify:"space-between",br:"8px",padding:"20px",bg:"rgba(255, 255, 255, 0.06)",w:"100%",">button":{h:"25px",br:"10px",minW:"50px","&:first-child":{minW:"140px"},div:{fs:"16px",border:"none",br:"10px"}},"@sm":{padding:"5px",justify:"center",gap:"5px",">button":{w:"50px",maxW:"50px",minW:"50px"}}}),is=c("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{align:"center",padding:"0px"}}),rs=ve({"0%":{rotate:"0deg"},"100%":{rotate:"360deg"}}),ns=c("button",{variants:{isLoading:{true:{svg:{animation:`${rs} 1.2s ease-in-out infinite`}}}}}),os=c("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"56px",mt:"65px",w:"100%","@md":{d:"flex",justify:"center",padding:"0 20px"},"@sm":{mt:"45px",gap:"35px",padding:"0 10px"}}),me=c("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",maxW:"250px","@sm":{w:"100%",maxW:"unset"}}),ue=c("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{gap:"10px",direction:"row",w:"100%"}}),fe=c("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column"}),he=c("div",{d:"flex",align:"center",justify:"center",overflow:"hidden",h:"140px",w:"100%",borderRadius:"8px",border:"3px solid rgba(255, 255, 255, 0.06)",button:{w:"82px",h:"82px",position:"absolute",left:"-30px",top:"-30px",zIndex:1,"@sm":{left:"-15px",top:"-20px",w:"50px",h:"50px"}},">img:nth-child(2)":{objectFit:"cover",h:"140px",w:"100%"},"@sm":{w:"100%",maxW:"150px",h:"80px",">img:nth-child(2)":{objectFit:"cover",h:"80px",w:"100%"}}}),j=c("div",{d:"flex",span:{d:"flex",align:"center",justify:"center",gap:"7px",fs:"16px",ff:"$body",color:"$white500","&:nth-child(2)":{ml:"7px"},svg:{w:"20px",h:"20px"}},"@sm":{span:{fs:"14px"}}}),ge=c("img",{w:"82px",h:"82px",zIndex:1,"@sm":{left:"-15px",top:"-20px",w:"50px",h:"50px"}}),je=c("div",{d:"flex",align:"center",justify:"center",direction:"row",mb:"5px",w:"100%",">button":{h:"25px",minH:"40px",minW:"unset",w:"100%",div:{fs:"16px",border:"none",br:"10px"},"&:last-child":{position:"absolute",bottom:"155px",right:"5px",w:"40px",h:"40px",minH:"40px",minW:"40px",br:"10px",">div":{fs:"14px",border:"none",br:"10px"}}},"@sm":{w:"100%",">button":{w:"100%",maxW:"unset",minW:"unset","&:last-child":{position:"relative",bottom:"0px",right:"0px"}}}}),Le=ve({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),as=c("div",{d:"flex",w:"100%",h:"90px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Le} 1.2s ease-in-out infinite`,"@sm":{h:"215px",w:"100%"}}),cs=c("div",{d:"flex",w:"250px",h:"280px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Le} 1.2s ease-in-out infinite`,"@sm":{w:"100%",h:"275px"}});async function ls(i,y){const{executeTransaction:d}=Be(),F=xs(i,y);return!!await d(F)}function xs(i,y){return{actions:[{account:ke.MEMBERS_MC,name:"remfavtools",authorization:[{actor:i.name,permission:i.authorization.permission}],data:{wallet:i.name,asset_ids:y}}]}}const P=L.lazy(()=>T(()=>import("./hearth-broken-9be61495.js"),["assets/hearth-broken-9be61495.js","assets/index-b85ef81b.js","assets/index-55fec1ff.css"])),we=L.lazy(()=>T(()=>import("./star-291dafca.js"),["assets/star-291dafca.js","assets/index-b85ef81b.js","assets/index-55fec1ff.css"])),ye=L.lazy(()=>T(()=>import("./shards-c6178fe3.js"),["assets/shards-c6178fe3.js","assets/index-b85ef81b.js","assets/index-55fec1ff.css"])),be=L.lazy(()=>T(()=>import("./tlm-bb619b7e.js"),["assets/tlm-bb619b7e.js","assets/index-b85ef81b.js","assets/index-55fec1ff.css"])),ds=L.lazy(()=>T(()=>import("./refresh-ad768f2a.js"),["assets/refresh-ad768f2a.js","assets/index-b85ef81b.js","assets/index-55fec1ff.css"])),Vs=()=>{var q,Y,J,K;const{data:i,isFetching:y}=Pe(),{data:d,isFetching:F}=Ue(),{data:R,isFetching:Te}=qe(),{data:k}=Je(),{data:r,isLoading:B,isFetching:Ce}=$e(),o=A(e=>e.user),w=M(e=>e.nonce),Ee=M(e=>e.updateHashExpire),C=M(e=>e.isCalculating),z=M(e=>e.updateIsCalculating),[l,m]=h.useState(!1),[,N]=h.useState(!1),V=h.useCallback(e=>{var n;return(((n=i==null?void 0:i.userTools)==null?void 0:n.reduce((a,x)=>a+(x==null?void 0:x.nft_power),0))??0)*(e/10)},[i==null?void 0:i.userTools]);function _e(){Ae.setState({selectedPage:"main"})}const D=(q=r==null?void 0:r.favoriteTools)==null?void 0:q.findIndex(e=>{var t;return e.every(n=>{var a;return(a=i==null?void 0:i.userTools)==null?void 0:a.some(x=>x.asset_id===n.assetId)})&&e.length===((t=i==null?void 0:i.userTools)==null?void 0:t.length)});async function G(e){if(o){m(!0);try{const t=e.map(({assetId:a})=>a).join(",");if(await ze(o,t)){await v(1e3);const a=await ie(o==null?void 0:o.name);A.setState(x=>({...x,user:x.user?{...x.user,...a}:null})),await W(),S.success("Land removed from favorites")}}catch(t){console.error(t)}finally{m(!1)}}}async function Se(e){var t;if(o){m(!0);try{const n=e.map(({assetId:p})=>p).join(","),a=((t=o==null?void 0:o.usrsettings.find(p=>p.key.includes("toolset")&&p.value.includes(n)))==null?void 0:t.value)??"";if(await ls(o,a)){await v(1e3);const p=await ie(o==null?void 0:o.name);A.setState(u=>({...u,user:u.user?{...u.user,...p}:null})),await W(),S.success("Toolset removed from favorites")}}catch(n){console.error(n)}finally{m(!1)}}}async function Ie(e){if(!(!(i!=null&&i.userTools)||!o)){m(!0);try{const t=e==null?void 0:e.map(({assetId:a})=>Number(a));await De(o,t)&&(await v(1500),await Ge("tool.worlds"),await O(),S.success("Changed tools successfully"))}catch(t){console.error(t)}finally{m(!1)}}}async function U(e){if(o){m(!0);try{await Ve(o,e)&&(await v(1e3),await I(),S.success("Land changed successfully"))}catch(t){console.error(t)}finally{m(!1)}}}async function Me(){await re(),await I()}const H=h.useCallback(async e=>{m(!0);try{if(z(!0),await v(500),!o)return null;if(!(w!=null&&w.rand_str)){await He();const a=new Date;Ee(a.setMinutes(a.getMinutes()+1))}const t=(d==null?void 0:d.current_land)===e?void 0:e;await Qe(o,t)&&(await Oe(o==null?void 0:o.name),await Me(),await I())}catch(t){console.log(t)}finally{z(!1),m(!1)}},[o,d,w==null?void 0:w.rand_str]),E=h.useCallback(e=>{var x,p,u,_,X,Z,ee,se,te;const t=(e??0)/10;if(((x=i==null?void 0:i.userTools)==null?void 0:x.length)===1){const b=t*(((u=(p=i==null?void 0:i.userTools)==null?void 0:p[0])==null?void 0:u.delay)??0);return $(b,i,d)}const n=(_=i==null?void 0:i.userTools)==null?void 0:_.sort((b,Re)=>Re.delay-b.delay);if(((X=i==null?void 0:i.userTools)==null?void 0:X.length)===2){const b=t*((((Z=n==null?void 0:n[0])==null?void 0:Z.delay)??0)+(((ee=n==null?void 0:n[1])==null?void 0:ee.delay)??0)/2);return $(b,i,d)}const a=t*((((se=n==null?void 0:n[0])==null?void 0:se.delay)??0)+(((te=n==null?void 0:n[1])==null?void 0:te.delay)??0));return $(a,i,d)},[i,d]),f=h.useCallback(e=>ne(oe(E(e))),[E]),O=h.useCallback(async()=>{await re(),await Ye(),await I(),await W()},[]),Fe=Ce||y||F||Te;h.useEffect(()=>{const e=setInterval(()=>{r!=null&&r.favoriteLands.every(t=>ne(oe(E(t[0].delay)))==="MINE")?(N(t=>!t),clearInterval(e)):N(t=>!t)},1e3);return N(t=>!t),()=>clearInterval(e)},[r==null?void 0:r.favoriteLands,d,E]);const Q=(e,t)=>{var x,p,u;const a=(((u=(p=(x=k==null?void 0:k[(t==null?void 0:t.toLowerCase())||""])==null?void 0:x.find(({key:_})=>_==="min_commission"))==null?void 0:p.value)==null?void 0:u[1])||0)/100;return e<a?a:e};return s.jsxs(Ke,{children:[s.jsx(We,{size:30,color:"#fff",onClick:_e}),s.jsxs(de,{children:["Tool Favorites (",((Y=r==null?void 0:r.favoriteTools)==null?void 0:Y.length)??0,"/3)"]}),s.jsx(Xe,{children:B?Array.from({length:3}).map((e,t)=>s.jsx(as,{},t)):(((J=r==null?void 0:r.favoriteTools)==null?void 0:J.length)??0)===0?s.jsx(pe,{children:s.jsx("span",{children:"You don't have any favorite tool"})}):(K=r==null?void 0:r.favoriteTools)==null?void 0:K.map((e,t)=>s.jsxs(Ze,{isSelected:D===t,children:[s.jsx(es,{children:e==null?void 0:e.map(n=>s.jsx(ss,{rarity:n.rarity,title:n.name,children:s.jsx("img",{loading:"lazy",src:`${Ne}/ipfs/${n.img}`,alt:n.name})},xe()))}),s.jsxs(ts,{children:[s.jsx(g,{noBorder:!0,color:"solidBlue",disabled:D===t||l,isLoading:l,onClick:()=>Ie(e),children:"Equip"}),s.jsx(g,{disabled:l,isLoading:l,onClick:()=>Se(e),noBorder:!0,children:s.jsx(P,{})})]})]},xe()))}),s.jsxs(is,{children:[s.jsxs(de,{children:[s.jsxs("span",{children:["Land Favorites (",r==null?void 0:r.favoriteLands.length,"/30)"]}),s.jsx(ns,{isLoading:Fe,onClick:O,children:s.jsx(ds,{})})]}),s.jsx(os,{children:B?Array.from({length:8}).map((e,t)=>s.jsx(cs,{},t)):(r==null?void 0:r.favoriteLands.length)===0?s.jsx(pe,{children:s.jsx("span",{children:"You don't have any favorite land"})}):s.jsxs(s.Fragment,{children:[r==null?void 0:r.favoriteLands.filter(([e])=>f(e.delay)==="MINE").sort((e,t)=>t[0].delay-e[0].delay).flatMap(([e])=>s.jsxs(me,{children:[s.jsxs(ue,{children:[s.jsxs(he,{children:[s.jsx(le,{disabled:!(e!=null&&e.x)||!(e!=null&&e.y),delayDuration:10,text:`x: ${e==null?void 0:e.x}, y: ${e==null?void 0:e.y}`,children:s.jsx(ge,{src:`/assets/planets/${e==null?void 0:e.planetName.toLowerCase()}.png`,alt:e==null?void 0:e.planetName,title:e==null?void 0:e.planetName})}),s.jsx("img",{loading:"lazy",src:`/assets/lands/${e.landName}.webp`,alt:e.landName,title:e.landName})]}),s.jsxs(fe,{children:[s.jsxs(j,{children:[s.jsx("span",{children:"Estimated TLM:"}),s.jsxs("span",{children:[ae({land:e}).toFixed(4),s.jsx(be,{})]})]}),s.jsxs(j,{children:[s.jsx("span",{children:"Estimated shards:"}),s.jsxs("span",{children:[ce({landCardId:e.cardid,landsType:R,userTools:i==null?void 0:i.userTools})," ",s.jsx(ye,{})]})]}),s.jsxs(j,{children:[s.jsx("span",{children:"Estimated MCP:"}),s.jsxs("span",{children:[V(e.luck).toLocaleString("US-en")," ",s.jsx(we,{})]})]}),s.jsxs(j,{children:[s.jsx("span",{children:"Commission:"}),s.jsxs("span",{children:[Q(e.commission/100,e==null?void 0:e.planetName.toLowerCase())," %"]})]})]})]}),s.jsxs(je,{children:[s.jsx(g,{isLoading:l,disabled:l,onClick:()=>U(e.assetId),color:"solidBlue",children:"Select"}),s.jsx(g,{color:"solidBlue",isLoading:l||C,disabled:l||C||f(e.delay)!=="MINE",onClick:()=>H(e.assetId),children:f(e.delay)==="MINE"?"Mine":f(e.delay)}),s.jsx(g,{isLoading:l,disabled:l,onClick:()=>G([e]),noBorder:!0,children:s.jsx(P,{})})]})]},e.assetId)),r==null?void 0:r.favoriteLands.filter(([e])=>f(e.delay)!=="MINE").sort((e,t)=>e[0].delay-t[0].delay).flatMap(([e])=>s.jsxs(me,{children:[s.jsxs(ue,{children:[s.jsxs(he,{children:[s.jsx(le,{disabled:!(e!=null&&e.x)||!(e!=null&&e.y),delayDuration:10,text:`x: ${e==null?void 0:e.x}, y: ${e==null?void 0:e.y}`,children:s.jsx(ge,{src:`/assets/planets/${e==null?void 0:e.planetName.toLowerCase()}.png`,alt:e==null?void 0:e.planetName,title:e==null?void 0:e.planetName})}),s.jsx("img",{loading:"lazy",src:`/assets/lands/${e.landName}.webp`,alt:e.landName,title:e.landName})]}),s.jsxs(fe,{children:[s.jsxs(j,{children:[s.jsx("span",{children:"Estimated TLM:"}),s.jsxs("span",{children:[ae({land:e}).toFixed(4),s.jsx(be,{})]})]}),s.jsxs(j,{children:[s.jsx("span",{children:"Estimated shards:"}),s.jsxs("span",{children:[ce({landCardId:e.cardid,landsType:R,userTools:i==null?void 0:i.userTools})," ",s.jsx(ye,{})]})]}),s.jsxs(j,{children:[s.jsx("span",{children:"Estimated MCP:"}),s.jsxs("span",{children:[V(e.luck).toLocaleString("US-en")," ",s.jsx(we,{})]})]}),s.jsxs(j,{children:[s.jsx("span",{children:"Commission:"}),s.jsxs("span",{children:[Q(e.commission/100,e==null?void 0:e.planetName.toLowerCase())," %"]})]})]})]}),s.jsxs(je,{children:[s.jsx(g,{isLoading:l,disabled:l,onClick:()=>U(e.assetId),color:"solidBlue",children:"Select"}),s.jsx(g,{color:"solidBlue",isLoading:l||C,disabled:l||C||f(e.delay)!=="MINE",onClick:()=>H(e.assetId),children:f(e.delay)==="MINE"?"Mine":f(e.delay)}),s.jsx(g,{isLoading:l,disabled:l,onClick:()=>G([e]),noBorder:!0,children:s.jsx(P,{})})]})]},e.assetId))]})})]})]})};export{Vs as default};
