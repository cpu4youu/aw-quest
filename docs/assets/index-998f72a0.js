import{s as c,e as Le,S as Ae,R as y,_ as C,u as A,r as u,j as s,A as We,B as g,D as re,f as E}from"./index-5c5264f1.js";import{u as $e}from"./index-bf24dff9.js";import{a as Pe}from"./index.esm-a38adaf4.js";import{u as Be,o as W}from"./get-user-settings-assets-query-95c9fe66.js";import{u as ze,o as ne}from"./tools-query-c06ab5f1.js";import{u as Ve}from"./use-transaction-d600ec16.js";import{s as L}from"./sleep-da79c358.js";import{a as De,e as Ue}from"./execute-remove-favorites-land-contract-ee9bf2b8.js";import{e as Ge}from"./execute-equip-tools-contract-3e14b88d.js";import{o as He}from"./inventory-query-746d8f16.js";import{u as Oe,o as M}from"./user-miners-query-ec01b1e1.js";import{u as I,g as Qe,s as qe}from"./showTlmValueFromMine-b6c99725.js";import{e as Ye}from"./execute-claim-contract-a181c4ae.js";import{d as $,a as oe,c as ae}from"./mineCooldown-a94e265a.js";import{u as Je,o as Ke}from"./lands-query-a63964d1.js";import{c as ce,a as le}from"./calculateShardsByLand-fb47a860.js";import{T as de}from"./index-a6976370.js";import{u as Xe}from"./get-planet-config-9a2467df.js";import{v as xe}from"./v4-4a60fe23.js";import"./iconBase-6df78a68.js";import"./adapters-4a503dd2.js";import"./axios-45629df5.js";import"./toast-options-bcc4cf31.js";import"./lands-fe32c224.js";import"./index-1aba9e3c.js";import"./index-220d4c40.js";import"./index-c01884cf.js";import"./index-af704bdb.js";import"./use-media-8ab1fd2a.js";const Ze=c("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px",padding:"0 10px",">svg":{mr:"auto",mt:"20px",cursor:"pointer"}}),pe=c("h3",{d:"flex",justify:"space-between",w:"100%",mr:"auto",mt:"25px",gap:"10px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500",">button":{h:"25px",div:{fs:"16px",border:"none",br:"10px"}},"@sm":{align:"center",fs:"18px",flexWrap:"wrap",svg:{w:"25px",h:"25px"}}}),me=c("h4",{w:"100%",textAlign:"center",fs:"22px",fw:"$normal",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),es=c("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"30px",mb:"30px",w:"100%","@sm":{gap:"10px",justify:"center"}}),ss=c("div",{d:"flex",align:"center",justify:"center",w:"100%",variants:{isSelected:{true:{">div:last-child":{border:"3px solid #00BAFF","@sm":{border:"1px solid #00BAFF"}}}}},"@sm":{justify:"center"}}),ts=c("div",{d:"flex",align:"center",justify:"flex-start",gap:"6px",w:"100%",maxW:"260px"}),is=c("div",{w:"82px",h:"82px",border:"3px solid $black500",overflow:"hidden",br:"5px",">img":{w:"82px",h:"82px",objectFit:"cover",objectPosition:"center 3px",scale:"1.9"},variants:{rarity:{Abundant:{borderColor:"#4c4c4c"},Common:{borderColor:"#000000"},Rare:{borderColor:"#3d74e9"},Epic:{borderColor:"#8719f0"},Legendary:{borderColor:"#da992e"},Mythical:{borderColor:"#d20066"}}},"@sm":{w:"52px",h:"52px",">img":{w:"52px",h:"52px"}}}),rs=c("div",{d:"flex",align:"center",justify:"space-between",br:"8px",padding:"20px",bg:"rgba(255, 255, 255, 0.06)",w:"100%",">button":{h:"25px",br:"10px",minW:"50px","&:first-child":{minW:"140px"},div:{fs:"16px",border:"none",br:"10px"}},"@sm":{padding:"5px",justify:"center",gap:"5px",">button":{w:"50px",maxW:"50px",minW:"50px"}}}),ns=c("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{align:"center",padding:"0px"}}),os=Le({"0%":{rotate:"0deg"},"100%":{rotate:"360deg"}}),as=c("button",{variants:{isLoading:{true:{svg:{animation:`${os} 1.2s ease-in-out infinite`}}}}}),cs=c("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"56px",mt:"65px",w:"100%","@md":{d:"flex",justify:"center",padding:"0 20px"},"@sm":{mt:"45px",gap:"35px",padding:"0 10px"}}),ue=c("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",maxW:"250px","@sm":{w:"100%",maxW:"unset"}}),fe=c("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{gap:"10px",direction:"row",w:"100%"}}),he=c("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column"}),ge=c("div",{d:"flex",align:"center",justify:"center",overflow:"hidden",h:"140px",w:"100%",borderRadius:"8px",border:"3px solid rgba(255, 255, 255, 0.06)",button:{w:"82px",h:"82px",position:"absolute",left:"-30px",top:"-30px",zIndex:1,"@sm":{left:"-15px",top:"-20px",w:"50px",h:"50px"}},">img:nth-child(2)":{objectFit:"cover",h:"140px",w:"100%"},"@sm":{w:"100%",maxW:"150px",h:"80px",">img:nth-child(2)":{objectFit:"cover",h:"80px",w:"100%"}}}),w=c("div",{d:"flex",span:{d:"flex",align:"center",justify:"center",gap:"7px",fs:"16px",ff:"$body",color:"$white500","&:nth-child(2)":{ml:"7px"},svg:{w:"20px",h:"20px"}},"@sm":{span:{fs:"14px"}}}),we=c("img",{w:"82px",h:"82px",zIndex:1,"@sm":{left:"-15px",top:"-20px",w:"50px",h:"50px"}}),je=c("div",{d:"flex",align:"center",justify:"center",direction:"row",mb:"5px",w:"100%",">button":{h:"25px",minH:"40px",minW:"unset",w:"100%",div:{fs:"16px",border:"none",br:"10px"},"&:last-child":{position:"absolute",bottom:"155px",right:"5px",w:"40px",h:"40px",minH:"40px",minW:"40px",br:"10px",">div":{fs:"14px",border:"none",br:"10px"}}},"@sm":{w:"100%",">button":{w:"100%",maxW:"unset",minW:"unset","&:last-child":{position:"relative",bottom:"0px",right:"0px"}}}}),Ce=Le({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),ls=c("div",{d:"flex",w:"100%",h:"90px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Ce} 1.2s ease-in-out infinite`,"@sm":{h:"215px",w:"100%"}}),ds=c("div",{d:"flex",w:"250px",h:"280px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Ce} 1.2s ease-in-out infinite`,"@sm":{w:"100%",h:"275px"}});async function xs(i,b){const{executeTransaction:x}=Ve(),F=ps(i,b);return!!await x(F)}function ps(i,b){return{actions:[{account:Ae.MEMBERS_MC,name:"remfavtools",authorization:[{actor:i.name,permission:i.authorization.permission}],data:{wallet:i.name,asset_ids:b}}]}}const P=y.lazy(()=>C(()=>import("./hearth-broken-0e6590f0.js"),["assets/hearth-broken-0e6590f0.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),ye=y.lazy(()=>C(()=>import("./star-8ef7cc82.js"),["assets/star-8ef7cc82.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),be=y.lazy(()=>C(()=>import("./shards-723bed5d.js"),["assets/shards-723bed5d.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),ve=y.lazy(()=>C(()=>import("./tlm-222edea5.js"),["assets/tlm-222edea5.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),ms=y.lazy(()=>C(()=>import("./refresh-4b92a3c9.js"),["assets/refresh-4b92a3c9.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),us=y.memo(()=>{var Y,J,K,X;const{data:i,isFetching:b}=ze(),{data:x,isFetching:F}=Oe(),{data:R,isFetching:Te}=Je(),{data:k}=Xe(),{data:n,isLoading:B,isFetching:Se}=Be(),o=A(e=>e.user),j=I(e=>e.nonce),z=I(e=>e.updateHashExpire),T=I(e=>e.isCalculating),N=I(e=>e.updateIsCalculating),[l,m]=u.useState(!1),[,_e]=u.useState(!1),V=u.useCallback(e=>{var r;return(((r=i==null?void 0:i.userTools)==null?void 0:r.reduce((a,d)=>a+(d==null?void 0:d.nft_power),0))??0)*(e/10)},[i==null?void 0:i.userTools]);function Ee(){$e.setState({selectedPage:"main"})}const D=(Y=n==null?void 0:n.favoriteTools)==null?void 0:Y.findIndex(e=>{var t;return e.every(r=>{var a;return(a=i==null?void 0:i.userTools)==null?void 0:a.some(d=>d.asset_id===r.assetId)})&&e.length===((t=i==null?void 0:i.userTools)==null?void 0:t.length)});async function U(e){if(o){m(!0);try{const t=e.map(({assetId:a})=>a).join(",");if(await De(o,t)){await L(1e3);const a=await re(o==null?void 0:o.name);A.setState(d=>({...d,user:d.user?{...d.user,...a}:null})),await W(),E.success("Land removed from favorites")}}catch(t){console.error(t)}finally{m(!1)}}}async function Me(e){var t;if(o){m(!0);try{const r=e.map(({assetId:p})=>p).join(","),a=((t=o==null?void 0:o.usrsettings.find(p=>p.key.includes("toolset")&&p.value.includes(r)))==null?void 0:t.value)??"";if(await xs(o,a)){await L(1e3);const p=await re(o==null?void 0:o.name);A.setState(f=>({...f,user:f.user?{...f.user,...p}:null})),await W(),E.success("Toolset removed from favorites")}}catch(r){console.error(r)}finally{m(!1)}}}async function Ie(e){if(!(!(i!=null&&i.userTools)||!o)){m(!0);try{const t=e==null?void 0:e.map(({assetId:a})=>Number(a));await Ge(o,t)&&(await L(1500),await He("tool.worlds"),await Q(),E.success("Changed tools successfully"))}catch(t){console.error(t)}finally{m(!1)}}}async function G(e){if(o){m(!0);try{await Ue(o,e)&&(await L(1e3),await M(),E.success("Land changed successfully"))}catch(t){console.error(t)}finally{m(!1)}}}const H=u.useCallback(async()=>{await ne(),await M()},[]),O=u.useCallback(async e=>{m(!0);try{if(N(!0),await L(500),!o)return null;if(!(j!=null&&j.rand_str)){await Qe();const a=new Date;z(a.setMinutes(a.getMinutes()+1))}const t=(x==null?void 0:x.current_land)===e?void 0:e;await Ye(o,t)&&(await qe(o==null?void 0:o.name),await H(),await M())}catch(t){console.log(t)}finally{N(!1),m(!1)}},[o,x,j==null?void 0:j.rand_str,z,N,H]),S=u.useCallback(e=>{var d,p,f,_,Z,ee,se,te,ie;const t=(e??0)/10;if(((d=i==null?void 0:i.userTools)==null?void 0:d.length)===1){const v=t*(((f=(p=i==null?void 0:i.userTools)==null?void 0:p[0])==null?void 0:f.delay)??0);return $(v,i,x)}const r=(_=i==null?void 0:i.userTools)==null?void 0:_.sort((v,Ne)=>Ne.delay-v.delay);if(((Z=i==null?void 0:i.userTools)==null?void 0:Z.length)===2){const v=t*((((ee=r==null?void 0:r[0])==null?void 0:ee.delay)??0)+(((se=r==null?void 0:r[1])==null?void 0:se.delay)??0)/2);return $(v,i,x)}const a=t*((((te=r==null?void 0:r[0])==null?void 0:te.delay)??0)+(((ie=r==null?void 0:r[1])==null?void 0:ie.delay)??0));return $(a,i,x)},[i,x]),h=u.useCallback(e=>oe(ae(S(e))),[S]),Q=u.useCallback(async()=>{await ne(),await Ke(),await M(),await W()},[]),{canMineLands:Fe,onCooldownLands:Re}=u.useMemo(()=>n!=null&&n.favoriteLands?n.favoriteLands.reduce((e,t)=>{const r=t[0];return h(r.delay)==="MINE"?e.canMineLands.push(t):e.onCooldownLands.push(t),e},{canMineLands:[],onCooldownLands:[]}):{canMineLands:[],onCooldownLands:[]},[n==null?void 0:n.favoriteLands,h]),ke=Se||b||F||Te;u.useEffect(()=>{const e=setInterval(()=>{n!=null&&n.favoriteLands.every(t=>oe(ae(S(t[0].delay)))==="MINE")&&clearInterval(e),_e(t=>!t)},1e3);return()=>clearInterval(e)},[n==null?void 0:n.favoriteLands,x,S]);const q=(e,t)=>{var d,p,f;const a=(((f=(p=(d=k==null?void 0:k[(t==null?void 0:t.toLowerCase())||""])==null?void 0:d.find(({key:_})=>_==="min_commission"))==null?void 0:p.value)==null?void 0:f[1])||0)/100;return e<a?a:e};return s.jsxs(Ze,{children:[s.jsx(Pe,{size:30,color:"#fff",onClick:Ee}),s.jsxs(pe,{children:["Tool Favorites (",((J=n==null?void 0:n.favoriteTools)==null?void 0:J.length)??0,"/3)"]}),s.jsx(es,{children:B?Array.from({length:3}).map((e,t)=>s.jsx(ls,{},t)):(((K=n==null?void 0:n.favoriteTools)==null?void 0:K.length)??0)===0?s.jsx(me,{children:s.jsx("span",{children:"You don't have any favorite tool"})}):(X=n==null?void 0:n.favoriteTools)==null?void 0:X.map((e,t)=>s.jsxs(ss,{isSelected:D===t,children:[s.jsx(ts,{children:e==null?void 0:e.map(r=>s.jsx(is,{rarity:r.rarity,title:r.name,children:s.jsx("img",{loading:"lazy",src:`${We}/ipfs/${r.img}`,alt:r.name})},xe()))}),s.jsxs(rs,{children:[s.jsx(g,{noBorder:!0,color:"solidBlue",disabled:D===t||l,isLoading:l,onClick:()=>Ie(e),children:"Equip"}),s.jsx(g,{disabled:l,isLoading:l,onClick:()=>Me(e),noBorder:!0,children:s.jsx(P,{})})]})]},xe()))}),s.jsxs(ns,{children:[s.jsxs(pe,{children:[s.jsxs("span",{children:["Land Favorites (",n==null?void 0:n.favoriteLands.length,"/30)"]}),s.jsx(as,{isLoading:ke,onClick:Q,children:s.jsx(ms,{})})]}),s.jsx(cs,{children:B?Array.from({length:8}).map((e,t)=>s.jsx(ds,{},t)):(n==null?void 0:n.favoriteLands.length)===0?s.jsx(me,{children:s.jsx("span",{children:"You don't have any favorite land"})}):s.jsxs(s.Fragment,{children:[Fe.sort((e,t)=>t[0].delay-e[0].delay).flatMap(([e])=>s.jsxs(ue,{children:[s.jsxs(fe,{children:[s.jsxs(ge,{children:[s.jsx(de,{disabled:!(e!=null&&e.x)||!(e!=null&&e.y),delayDuration:10,text:`x: ${e==null?void 0:e.x}, y: ${e==null?void 0:e.y}`,children:s.jsx(we,{src:`/assets/planets/${e==null?void 0:e.planetName.toLowerCase()}.png`,alt:e==null?void 0:e.planetName,title:e==null?void 0:e.planetName})}),s.jsx("img",{loading:"lazy",src:`/assets/lands/${e.landName}.webp`,alt:e.landName,title:e.landName})]}),s.jsxs(he,{children:[s.jsxs(w,{children:[s.jsx("span",{children:"Estimated TLM:"}),s.jsxs("span",{children:[ce({land:e}).toFixed(4),s.jsx(ve,{})]})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Estimated shards:"}),s.jsxs("span",{children:[le({landCardId:e.cardid,landsType:R,userTools:i==null?void 0:i.userTools})," ",s.jsx(be,{})]})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Estimated MCP:"}),s.jsxs("span",{children:[V(e.luck).toLocaleString("US-en")," ",s.jsx(ye,{})]})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Commission:"}),s.jsxs("span",{children:[q(e.commission/100,e==null?void 0:e.planetName.toLowerCase())," %"]})]})]})]}),s.jsxs(je,{children:[s.jsx(g,{isLoading:l,disabled:l,onClick:()=>G(e.assetId),color:"solidBlue",children:"Select"}),s.jsx(g,{color:"solidBlue",isLoading:l||T,disabled:l||T||h(e.delay)!=="MINE",onClick:()=>O(e.assetId),children:h(e.delay)==="MINE"?"Mine":h(e.delay)}),s.jsx(g,{isLoading:l,disabled:l,onClick:()=>U([e]),noBorder:!0,children:s.jsx(P,{})})]})]},e.assetId)),Re.sort((e,t)=>e[0].delay-t[0].delay).flatMap(([e])=>s.jsxs(ue,{children:[s.jsxs(fe,{children:[s.jsxs(ge,{children:[s.jsx(de,{disabled:!(e!=null&&e.x)||!(e!=null&&e.y),delayDuration:10,text:`x: ${e==null?void 0:e.x}, y: ${e==null?void 0:e.y}`,children:s.jsx(we,{src:`/assets/planets/${e==null?void 0:e.planetName.toLowerCase()}.png`,alt:e==null?void 0:e.planetName,title:e==null?void 0:e.planetName})}),s.jsx("img",{loading:"lazy",src:`/assets/lands/${e.landName}.webp`,alt:e.landName,title:e.landName})]}),s.jsxs(he,{children:[s.jsxs(w,{children:[s.jsx("span",{children:"Estimated TLM:"}),s.jsxs("span",{children:[ce({land:e}).toFixed(4),s.jsx(ve,{})]})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Estimated shards:"}),s.jsxs("span",{children:[le({landCardId:e.cardid,landsType:R,userTools:i==null?void 0:i.userTools})," ",s.jsx(be,{})]})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Estimated MCP:"}),s.jsxs("span",{children:[V(e.luck).toLocaleString("US-en")," ",s.jsx(ye,{})]})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Commission:"}),s.jsxs("span",{children:[q(e.commission/100,e==null?void 0:e.planetName.toLowerCase())," %"]})]})]})]}),s.jsxs(je,{children:[s.jsx(g,{isLoading:l,disabled:l,onClick:()=>G(e.assetId),color:"solidBlue",children:"Select"}),s.jsx(g,{color:"solidBlue",isLoading:l||T,disabled:l||T||h(e.delay)!=="MINE",onClick:()=>O(e.assetId),children:h(e.delay)==="MINE"?"Mine":h(e.delay)}),s.jsx(g,{isLoading:l,disabled:l,onClick:()=>U([e]),noBorder:!0,children:s.jsx(P,{})})]})]},e.assetId))]})})]})]})});us.displayName="Favorites";export{us as default};
