import{s as o,e as K,d as U,q as Y,Q as b,g as J,S as m,T as X,R as x,_ as f,u as T,r as c,j as t,B as ee,o as te,f as se}from"./index-5c5264f1.js";import{u as ne,L as re}from"./index-17f158f1.js";import{g as ie}from"./emporium-tasks-79d0b246.js";import{c as oe}from"./mineCooldown-a94e265a.js";import{s as A}from"./sleep-da79c358.js";import{u as ae}from"./use-transaction-d600ec16.js";import{a as ce}from"./index.esm-a38adaf4.js";import{F as le}from"./index.esm-a5a16321.js";import{T as pe}from"./index-a6976370.js";import"./index-1aba9e3c.js";import"./index-220d4c40.js";import"./toast-options-bcc4cf31.js";import"./iconBase-6df78a68.js";import"./index-c01884cf.js";import"./index-af704bdb.js";import"./use-media-8ab1fd2a.js";const ue=o("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%"}),de=o("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0},"@md":{h:"105px",img:{h:"105px"}},"@sm":{h:"65px",img:{h:"65px"}}}),me=o("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.8)",w:"100%","@sm":{fs:"24px"}}),xe=o("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",maxW:"1095px","@md":{px:"30px"},"@sm":{px:"15px"}}),fe=o("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mt:"48px"}),he=o("h3",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",color:"$white500",fs:"32px","@sm":{fs:"24px"}}),ge=o("p",{d:"inline-block",w:"100%",maxW:"811px",mt:"18px",mr:"auto",fs:"16px",fw:"$thin",ff:"$body",color:"$white500",span:{textDecoration:"underline"},"@sm":{mt:"10px",fs:"14px"}}),ye=o("div",{d:"flex",align:"center",justify:"center",direction:"column",mt:"18px",w:"100%"}),_e=o("h3",{d:"flex",align:"center",justify:"space-between",gap:"10px",w:"100%",color:"$white500",fs:"18px",span:{fs:"32px"},button:{d:"flex",align:"center",justify:"center",gap:"6px",color:"$white500",fw:"$bold",fs:"25px"},"@sm":{fs:"16px",span:{fs:"28px"}}}),we=o("div",{d:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"15px",flexWrap:"wrap",mt:"18px",w:"100%","@sm":{gap:"5px"}}),Te=o("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"5px",position:"relative",w:"100%",h:"100%",pb:"5px",border:"3px solid rgba(255, 255, 255, 0.4)",img:{w:"100%",h:"100%",maxH:"135px",objectFit:"cover"},">button":{w:"100%",mt:"auto",">button":{fs:"18px",padding:"0px",mx:"auto",w:"95%",minW:"95%",maxW:"95%",minH:"35px",div:{minH:"35px"}}},variants:{isSelected:{true:{">button":{color:"black"}}}},"@sm":{">button":{fs:"14px"}}}),be=o("div",{d:"flex",align:"center",justify:"center",gap:"10px",position:"absolute",top:"3px",left:"10px",color:"$white500",fs:"24px",fw:"$bold",ff:"$heading",svg:{w:"38px",h:"38px",ml:"-5px",path:{fill:"rgb(246, 168, 0)"}},"@sm":{fs:"16px",left:"5px",top:"0px",svg:{w:"25px",h:"25px"}}}),je=o("h4",{d:"flex",align:"center",justify:"center",direction:"column",padding:"3px 5px",color:"$white500",fs:"18px",ff:"$heading","@sm":{fs:"14px"}}),ve=o("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"10px",w:"100%",my:"10px",pl:"5px",color:"$white500",fs:"13px",ff:"$body",">svg":{w:"20px",h:"20px"},"@sm":{fs:"12px"}}),Se=o("p",{w:"100%",my:"auto",pl:"5px",color:"$white500",fs:"13px",ff:"$body",svg:{verticalAlign:"sub",w:"16px",h:"16px",my:"auto",mx:"3px","&:last-of-type":{mr:"3px",w:"19px",h:"19px",path:{fill:"rgb(246, 168, 0)"}}},"@sm":{fs:"12px"}}),$e=o("p",{w:"100%",pl:"5px",color:"$white500",fs:"14px",ff:"$body",span:{display:"inline-flex",align:"center",gap:"3px"},svg:{verticalAlign:"sub",w:"16px",h:"16px",mr:"3px"},"@sm":{fs:"12px"}}),Ce=K({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Le=o("div",{d:"flex",w:"100%",maxW:"260px",h:"325px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Ce} 1.2s ease-in-out infinite`,"@sm":{h:"215px",w:"100%"}}),Me=()=>U({queryKey:[b.Tasks],queryFn:()=>Pe(),staleTime:1e3*60*60});async function Ee(){return await Y.removeQueries([b.Tasks])}async function Pe(){try{const n=await ie("active");return n||[]}catch(n){return console.log(n),[]}}const ke=async()=>{const n=await J({options:{code:m.EMPORIUM,index_position:1,limit:"10000",scope:m.EMPORIUM,table:X.CONFIG}});return n?n[0]:null},Ie=()=>U({queryKey:[b.TasksConfig],queryFn:()=>Ae(),staleTime:1e3*60*60});async function Ae(){try{return await ke()}catch(n){return console.log(n),null}}async function De(n,u,r,a){const{executeTransaction:h}=ae(),g=await Re(n,u,r,a);return!!await h(g)}async function Re(n,u,r,a){return a==="tlm"?{actions:[{account:m.ALIEN_WORLDS,name:"transfer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{from:n.name,memo:`complete task,${u}`,quantity:`${r.toFixed(4)} TLM`,to:"emporium.mc"}}]}:{actions:[{account:m.EMPORIUM,name:"finishtask",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,task_id:u,currency_amount:r}}]}}const D=x.lazy(()=>f(()=>import("./tlm-222edea5.js"),["assets/tlm-222edea5.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),Ue=x.lazy(()=>f(()=>import("./star-8ef7cc82.js"),["assets/star-8ef7cc82.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),R=x.lazy(()=>f(()=>import("./atom-af5cb42b.js"),["assets/atom-af5cb42b.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),ze=x.lazy(()=>f(()=>import("./quest-ffbed1e1.js"),["assets/quest-ffbed1e1.js","assets/index-5c5264f1.js","assets/index-55fec1ff.css"])),st=()=>{const{data:n,isLoading:u}=Me(),{data:r}=Ie(),a=T(e=>e.user),h=T(e=>e.updateMcPoints),g=T(e=>e.updateTLM),j=ne(e=>e.onChangePage),[l,v]=c.useState(void 0),[d,S]=c.useState(3),[z,B]=c.useState(""),[y,$]=c.useState(!1),[_,F]=c.useState([]);async function W(e){if(!(!a||!e.current_price)){$(!0);try{await De(a,e.task_id,e.current_price,e.task_type)&&(await A(1500),await C(),e.task_type==="tlm"&&await g(),e.task_type==="qp"&&await te(),await h(),se.success("Task completed successfully"))}catch(s){console.error(s)}finally{$(!1)}}}async function C(){await A(1e3),await Ee()}function q(e){if(e.task_id===l){W(e);return}v(e.task_id)}function O(){v(void 0)}const L=c.useCallback(()=>{const e=new Date(new Date().toUTCString().substring(0,25)),s=(r==null?void 0:r.progressupdate_seconds)??0,i=Math.floor(e.getTime()/1e3);return new Date((Math.floor(i/s)*s+s)*1e3)},[r==null?void 0:r.progressupdate_seconds]),M=c.useCallback(e=>{const s=e.minutes>0?`${e.minutes>9?e.minutes:`0${e.minutes}`}`:"00",i=e.seconds>9?e.seconds:`0${e.seconds}`,p=e.hours>9?e.hours:`0${e.hours}`;return e.hours>0?`${p}:${s}:${i}`:`${s}:${i}`},[]),E=c.useCallback(e=>{const s=new Date(new Date().toUTCString().substring(0,25)),i=(r==null?void 0:r.progressupdate_seconds)??1,p=(r==null?void 0:r.tick_percent_decrease)??1,Q=Math.floor(s.getTime()/1e3),V=Math.floor(new Date(e==null?void 0:e.timestamp_created).getTime()/1e3),H=Math.floor(V/i)*i,N=Math.floor(Q/i)*i-H,G=Math.floor(N/i),Z=p*-1/100,I=e.currency_start*Math.pow(1+Z,G);return e.task_type==="tlm"?Math.ceil(I/1e4):Math.floor(I)},[r]),w=c.useCallback(e=>{switch(e){case"qp":return t.jsx(ze,{});case"mcp":return t.jsx(Ue,{});case"tlm":return t.jsx(D,{});default:return t.jsx(D,{})}},[]),P=c.useCallback((e,s=0)=>{var i,p;return e==="mcp"?((a==null?void 0:a.mcPoints)??0)<s:e==="tlm"?(Number((i=a==null?void 0:a.userTlm)==null?void 0:i.balance)??0)<s:e==="qp"?(((p=a==null?void 0:a.userWeekly)==null?void 0:p.total_quest_points)??0)<s:!0},[a]),k=c.useMemo(()=>n?n.map(e=>({...e,current_price:E(e)})):[],[n,E]);return c.useEffect(()=>{F(k)},[k]),c.useEffect(()=>{const e=setInterval(()=>{const s=oe(L());B(M(s)),s.minutes===0&&s.seconds<=5&&C()},1e3);return()=>clearInterval(e)},[r,M,L]),c.useEffect(()=>{let e=3;S(3);const s=setInterval(()=>{S(i=>i-1),e--,e===0&&clearInterval(s)},1e3);return()=>clearInterval(s)},[l]),t.jsx(c.Suspense,{fallback:t.jsx(re,{}),children:t.jsxs(ue,{children:[t.jsxs(de,{children:[t.jsx(me,{children:"Zappâ€™s Zap Emporium"}),t.jsx("img",{loading:"lazy",src:"/assets/background/bg-emporium.webp",alt:""})]}),t.jsxs(xe,{children:[t.jsxs(fe,{children:[t.jsx(he,{children:"Zapp's Tasks"}),t.jsxs(ge,{children:["Zapp is currently trying to advance various pressing issues. Assist him in finishing tasks! Zapp will reward the helping player with Alien Worlds Shards he found on his journeys. Since he consistently dedicates time to these tasks, each one becomes easier to complete over time. Once a task is finished by ",t.jsx("u",{children:"any"})," player, it will be replaced by a new one."]})]}),t.jsxs(ye,{children:[t.jsxs(_e,{children:[t.jsxs("p",{children:["Next Task Progress: ",t.jsx("span",{children:z})]}),t.jsxs("button",{onClick:()=>j("history"),children:[t.jsx(le,{}),"History"]})]}),t.jsx(we,{children:u?Array.from({length:8}).map((e,s)=>t.jsx(Le,{},s)):_==null?void 0:_.map(e=>{var s;return t.jsxs(Te,{isSelected:l===e.task_id,children:[t.jsxs(be,{children:[(e.shards/10).toLocaleString("en-US")," ",t.jsx(R,{})]}),t.jsx("img",{loading:"lazy",src:`/assets/tasks/${e.image}.jpeg`,title:e.title,alt:e.title}),l!==e.task_id&&t.jsx(je,{children:e.title}),l===e.task_id?t.jsxs(ve,{children:[t.jsx(ce,{size:30,color:"#fff",onClick:O}),t.jsxs(Se,{children:["Are you sure you want to spend"," ",t.jsxs(t.Fragment,{children:[(s=e==null?void 0:e.current_price)==null?void 0:s.toLocaleString("en-US"),e.task_type==="tlm"&&" (TLM)",w(e.task_type)]}),"to complete the task and gain"," ",(e.shards/10).toLocaleString("en-US"),t.jsx(R,{}),"?"]})]}):t.jsx($e,{children:e.description.split("[currency]").flatMap(i=>{var p;return[i,t.jsxs("span",{children:[(p=e==null?void 0:e.current_price)==null?void 0:p.toLocaleString("en-US"),w(e.task_type)]},i)]}).slice(0,-1)}),t.jsx(pe,{disabled:y||!P(e.task_type,e.current_price)||l===e.task_id||d>0&&l===e.task_id,delayDuration:10,text:t.jsxs(t.Fragment,{children:["Not enough ",w(e.task_type)]}),children:t.jsx(ee,{disabled:y||P(e.task_type,e.current_price)||d>0&&l===e.task_id,isLoading:y,onClick:()=>q(e),color:l===e.task_id?"gradientYellow":"solidBlue",noBorder:!0,rounded:!1,children:l===e.task_id?`Confirm ${d?`(${d}) s`:""}`:e.button})})]},e.task_id)})})]})]})]})})};export{st as default};
